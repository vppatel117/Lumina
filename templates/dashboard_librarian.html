{% extends "base.html" %}
{% block content %}
<section class="page-heading">
    <div>
        <h1>Librarian Control Center</h1>
        <p class="muted">Monitor circulation health, onboard titles, and assist patrons.</p>
    </div>
</section>

<section class="stats">
    <div class="stat">
        <span>Titles</span>
        <strong>{{ stats.titles }}</strong>
    </div>
    <div class="stat">
        <span>Total copies</span>
        <strong>{{ stats.copies }}</strong>
    </div>
    <div class="stat">
        <span>Borrowed</span>
        <strong>{{ stats.borrowed }}</strong>
    </div>
    <div class="stat">
        <span>Available</span>
        <strong>{{ stats.available }}</strong>
    </div>
    <div class="stat">
        <span>Overdue</span>
        <strong class="danger">{{ stats.overdue }}</strong>
    </div>
</section>

<section class="panel-grid">
    <article class="card">
        <h2>Active Loans</h2>
        <div class="table">
            <div class="row head">
                <span>Book</span>
                <span>Borrower</span>
                <span>Due</span>
                <span>Status</span>
                <span></span>
            </div>
            {% for loan in active_loans %}
            <div class="row">
                <span>{{ loan.book.title }}</span>
                <span>{{ loan.user.name }}</span>
                <span>{{ loan.due_date.strftime('%b %d, %Y') }}</span>
                <span class="{{ 'danger' if loan.is_overdue else 'success' }}">
                    {{ 'Overdue' if loan.is_overdue else 'On time' }}
                </span>
                <span>
                    <form action="{{ url_for('return_book', loan_id=loan.id) }}" method="post">
                        <button type="submit">Mark returned</button>
                    </form>
                </span>
            </div>
            {% else %}
            <p>No items are checked out right now.</p>
            {% endfor %}
        </div>
    </article>

    <article class="card form">
        <h2>Add New Title</h2>
        <form method="post" class="form-grid">
            <input type="hidden" name="form_type" value="add_book">
            <label>Title
                <input type="text" name="title" required>
            </label>
            <label>Author
                <input type="text" name="author" required>
            </label>
            <label>Copies
                <input type="number" min="1" name="copies" value="1">
            </label>
            <button type="submit" class="primary">Add book</button>
        </form>
    </article>

    <article class="card form">
        <h2>Manual Checkout</h2>
        <form method="post" class="form-grid">
            <input type="hidden" name="form_type" value="manual_checkout">
            <label>User email
                <input type="email" name="user_email" list="user-emails">
            </label>
            <label>Book
                <select name="book_id">
                    {% for book in books %}
                        <option value="{{ book.id }}">{{ book.title }} ({{ book.available_copies }} available)</option>
                    {% endfor %}
                </select>
            </label>
            <button type="submit" class="primary">Checkout</button>
        </form>
        <datalist id="user-emails">
            {% for user in users %}
                <option value="{{ user.email }}"></option>
            {% endfor %}
        </datalist>
    </article>
</section>
{% endblock %}
